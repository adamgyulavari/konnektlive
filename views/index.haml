!!!
%html{lang: 'hu', prefix: 'og: http://ogp.me/ns#'}
  %head
    %title= @texts['title']
    %meta{charset: 'utf-8'}
    %meta{content: "width=device-width, initial-scale=1", name: "viewport"}/
    %link{href: 'stylesheets/style16.css', rel: 'stylesheet'}
    %link{href: 'https://fonts.googleapis.com/css?family=Raleway:400,600,700|Roboto:300,400', rel: 'stylesheet'}
    %link{rel: 'stylesheet', href: 'https://use.fontawesome.com/releases/v5.0.9/css/all.css', integrity: 'sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1', crossorigin: 'anonymous'}
    %meta{content: @texts['title'], property: "og:title"}/
    %meta{content: "website", property: "og:type"}/
    %meta{content: "http://www.konnektlive.com", property: "og:url"}/
    %meta{content: "http://www.konnektlive.com/images/konnektlive_header.png", property: "og:image"}/
    %meta{content: @texts['og-desc'], property: 'og:description'}

%body
  - if display_section('header')
    %header.green.centered
      - if display_section('professions')
        %h2.menu{class: @rotations.sample, data: { id: 'professions' }} Szakmák
      - if display_section('details')
        %h2.menu{class: @rotations.sample, data: { id: 'details' }} Mi ez?
      - if display_section('program')
        %h2.menu{class: @rotations.sample, data: { id: 'program' }} Program
      - if display_section('registration')
        %h2.menu{class: @rotations.sample, data: { id: 'registration' }} Regisztráció
      - if display_section('sponsors')
        %h2.menu{class: @rotations.sample, data: { id: 'sponsors' }} Támogatók
  %section.title.strict#professions
    %img{src: 'images/konnekt_live_logo_white.png', alt: 'Konnekt Live logo'}
    - if display_section('professions')
      .profs
        - sort_by(@professions, 'title').each_with_index do |prof, index|
          - if displayable?(prof[1])
            %h4{id: "prof-#{prof[0]}", class: "#{prof[1]['image'] ? 'prof-item':''} #{@rotations.sample} #{(index % 2 == 0) ? 'blue' : 'purple'}", 
              data: prof[1]}= prof[1]['title']
        %h4{class: "#{@rotations.sample} green"}= @texts['and-more']
  %section.profession.green.closed.strict
    .first
      %img#prof_image{src: 'https://firebasestorage.googleapis.com/v0/b/konnektlive.appspot.com/o/To%CC%81th%20A%CC%81gi.JPG?alt=media&token=2684f4ff-b177-48e7-a7da-f9d652d23a91', alt: 'Toth Agi'}
      .details
        .close.icon
          %span.fas.fa-times
        %h2#prof_title{class: "#{@rotations.sample}"} Ruhatervezo
        %h3#prof_name Toth Agi
        %p#prof_description
          Elismert menekültekkel és oltalmazotti sátuszú emberekkel foglalkozom, akik hazájukat kényszerűségből elhagyva itt, nálunk kezdhetnek új életet. Munkám része a státusz megítélése utáni lépések: az elsődleges életfeltételekhez segítés (lakás, élelmiszer, munka), az egészségügyi- és egyéb ellátásokhoz jutás, a szociális és kulturális integráció segítése, pszichés támogatás, stb. Kisgyerekektől idős korig százféle életút, százféle igény, s ezer megoldási lehetőség színesítik a mindennapjaimat!
    .other
      %img#prof_image_other
      .details
        %h2#prof_title_other{class: "#{@rotations.sample}"} Ruhatervezo
        %h3#prof_name_other Toth Agi
        %p#prof_description_other
          Elismert menekültekkel és oltalmazotti sátuszú emberekkel foglalkozom, akik hazájukat kényszerűségből elhagyva itt, nálunk kezdhetnek új életet. Munkám része a státusz megítélése utáni lépések: az elsődleges életfeltételekhez segítés (lakás, élelmiszer, munka), az egészségügyi- és egyéb ellátásokhoz jutás, a szociális és kulturális integráció segítése, pszichés támogatás, stb. Kisgyerekektől idős korig százféle életút, százféle igény, s ezer megoldási lehetőség színesítik a mindennapjaimat!
  - if display_section('details')
    %section.white.main.strict#details
      %h1.rotate-r1.blue
        = @texts['white-header-1']
      %h2.rotate-l1.purple
        = @texts['white-header-2']
      .row
        .icon
          %span.far.fa-calendar-check
          %h3.rotate-l1= @texts['date-title']
          %p= @texts['date-description']
        .icon
          %span.fas.fa-user-md
          %h3.rotate-l2= @texts['prof-title']
          %p= @texts['prof-description']
        .icon
          %span.fas.fa-users
          %h3.rotate-r2= @texts['students-title']
          %p= @texts['students-description']
      .row
        .icon
          %span.far.fa-comments
          %h3.rotate-r1= @texts['talks-title']
          %p= @texts['talks-description']
        .icon
          %span.far.fa-thumbs-up
          %h3.rotate-l1= @texts['stories-title']
          %p= @texts['stories-description']
        .icon
          %span.fas.fa-user-circle
          %h3.rotate-r1= @texts['ex-title']
          %p= @texts['ex-description']
  - if display_section('location')
    %section.green.centered.whitened.strict#location
      %h2= @texts['loc-title']
      .row
        .icon
          %a{href: @texts['loc-link']}
            %span.fas.fa-map-marker-alt
            %h3.rotate-r2= @texts['loc-subtitle']
            %p= @texts['loc-description']
  - if display_section('program')
    %section.grey.whitened.strict#program
      %h2
        = @texts['programs-title']
      - if @texts.has_key? 'program-continous'
        .programs
          %h3.rotate-l1.blue= @texts['program-continous']
          %p= @texts['program-continous-details']
      - [@programs, @programs_uni].each_with_index do |programs, index|
        .programs
          - if programs
            %h3.rotate-r1.blue= @texts["program-#{index+1}-title"]
            - programs.each do |program|
              .program
                .start= program[1]['start']
                .end= program[1]['end']
                .details
                  %h3= program[1]['title']
                  - if program[1]['key']
                    - program[1]['key'].split(';').each do |k|
                      - if @professions.has_key? k
                        %h4.presenter{data: {key: k}}= @professions[k]['name'] + ', ' + @professions[k]['title']
                  - if program[1]['name']
                    - program[1]['name'].split(';').each do |n|
                      %h4= n
                  %p= program[1]['short']
  - if display_section('video')
    %section.grey.strict#video
      %figure
        %iframe{:allow => "autoplay; encrypted-media", :allowfullscreen => "", :frameborder => "0", :height => "315", :src => "https://www.youtube.com/embed/#{@texts['youtube-id']}?rel=0", :width => "560"}
  - if display_section('registration')
    %section.green.centered.whitened.strict#registration
      %h2{id: 'newsletter'}= @texts['reg-title']
      - unless @success
        %h6.text= @texts['reg-description']
        - if (@errors && !@errors.empty?)
          %p.error.purple= @errors.join(" ")
        %form{method: 'post', action: '/reg'}
          %input{name: 'reg[email]', class: 'email full', placeholder: 'Email cím', type: 'email', required: 'true', value: params['reg']['email']}
          %input{name: 'reg[name]', class: 'email full', placeholder: 'Teljes neved', type: 'name', required: 'true', value: params['reg']['name']}
          %input{name: 'reg[year]', class: 'email full', placeholder: 'Születési éved', type: 'number', required: 'true', value: params['reg']['year']}
          %input{name: 'reg[school]', class: 'email full', placeholder: 'Iskolád neve', type: 'text', required: 'true', value: params['reg']['school']}
          .row
            %input{name: 'reg[type]', type: 'checkbox', id: 'type-cb-teacher', value: 'teacher'}
            %label{for: 'type-cb-teacher'}
              %strong= @texts['reg-teacher']
          .row
            %input{name: 'reg[type]', type: 'checkbox', id: 'type-cb-student', value: 'student'}
            %label{for: 'type-cb-student'}
              %strong= @texts['reg-student']
          .prof-checks.gone
            - sort_by(@professions, 'title').each do |prof|
              - if prof[1]['title'] && !prof[1]['side']
                .prof
                  %input{name: "prof[]", value: prof[0], type: 'checkbox', id: "cb-prof-#{prof[0]}", checked: params['prof'] && params['prof'].include?(prof[0])}
                  %label{for: "cb-prof-#{prof[0]}"}= prof[1]['title']
          .row
            %input{name: 'reg[news]', type: 'checkbox', id: 'news-cb', value: 'registered'}
            %label{for: 'news-cb'}
              = @texts['reg-news']
          .row
            %input{name: 'reg[terms]', type: 'checkbox', id: 'terms-cb', value: 'accepted'}
            %label{for: 'terms-cb'}
              Az
              %a{href: @texts['terms-url'], target: '_blank'}= @texts['terms-title']
              \-et elfogadom
          .row
            %input{name: 'reg[pic-terms]', type: 'checkbox', id: 'pic-terms', value: 'accepted'}
            %label{for: 'pic-terms'}
              %a{href: @texts['terms-pics-url'], target: '_blank'}= @texts['terms-pics']
          %input{type: 'submit', value: @texts['reg-button'], class: 'full button'}
      - else
        %h6= @texts['reg-success']
      .fb-page{"data-adapt-container-width" => "true", "data-hide-cover" => "false", "data-href" => "https://www.facebook.com/konnektmentorprogram", "data-show-facepile" => "true", "data-small-header" => "true", "data-tabs" => "events"}
        %blockquote.fb-xfbml-parse-ignore{:cite => "https://www.facebook.com/konnektmentorprogram"}
          %a{:href => "https://www.facebook.com/konnektmentorprogram"} Konnekt Mentorprogram
  - if display_section('sponsors') && @sponsors
    %section.grey.whitened.centered#sponsors
      %h2= @texts['sponsor-title']
      .sponsors
        - @sponsors.each do |sponsor|
          %a{href: sponsor[1]['url'], target: '_blank'}
            %img{src: sponsor[1]['image'], alt: sponsor[1]['name']}
  - if display_section('partners') && @partners
    %section.white.whitened.centered
      %h2= @texts['partner-title']
      .partners
        - @partners.each do |sponsor|
          %a{href: sponsor[1]['url'], target: '_blank'}
            %img{src: sponsor[1]['image'], alt: sponsor[1]['name']}
  %section.green.whitened.centered.bottom
    %h4
      %a.email.onwhite{href: "mailto:#{@texts['email']}"}= @texts['email'] 
    %h3
      %a.onwhite{href: 'http://knnkt.org', target: '_blank'}
        ©2019 Konnekt Egyesület
      .social
        %a.onwhite{:href => "https://www.facebook.com/konnektegyesulet", :target => "_blank"}
          %i.fab.fa-facebook-square
        %a.onwhite{:href => "https://www.youtube.com/channel/UCec5Hmtp-Vuv2aNZhZBga3w", :target => "_blank"}
          %i.fab.fa-youtube
        %a.onwhite{:href => "https://www.instagram.com/konnektegyesulet", :target => "_blank"}
          %i.fab.fa-instagram
  %section.white.centered
    .scroller
      %a.onwhite.black{id: 'to-top', href: '#'}
        %img{src: 'images/arrow.png'}
        = @texts['to-top']
    
    .empty
  %script{:crossorigin => "anonymous", :integrity => "sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=", :src => "https://code.jquery.com/jquery-3.3.1.min.js"}
  - if @success || (@errors && !@errors.empty?) || params['from_reg']
    :javascript
      $(()=>{
        $('html, body').animate({
          scrollTop: $("#registration").offset().top
      }, 1000);
      })
  <!-- Facebook Pixel Code -->
  :javascript
    let to = { action: 'main page' }
    let action = 'PageView'
    if('#{ request.path_info }' === '/reg') {
      to = {
        action: 'user_registered',
        email: '#{ params[:email] }',
        content_name: '#{ params[:name] }'
      }
      action = 'CompleteRegistration'
    }
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1390298377797969');
    fbq('track', action, to);
  %noscript
    - uridata = 'PageView'
    - if request.path_info == '/reg'
      - uridata += "&cd[action]=user_registered&cd[email]=#{ params[:email] }&cd[content_name]=#{ params[:name] }"
    %img{height: "1", width: "1", style: "display:none", src: "https://www.facebook.com/tr?id=1390298377797969&ev=#{uridata}&noscript=1"}
  :javascript
    $('#to-top').on('click', (e) => {
      e.preventDefault()
      $('html, body').animate({
        scrollTop: 0
    }, 1000);
    })
    $('.menu').on('click', (e) => {
      $('html, body').animate({
            scrollTop: $('#'+ $(e.target).data('id')).offset().top - 100
      }, 500);
    })
    $('.presenter').on('click', (e) => {
      $('#prof-' + $(e.target).data('key')).click()
    })
    $('.profs .prof-item').on('click', (e) => {
      $('#prof_title').html($(e.target).data('title'))
      $('#prof_name').html($(e.target).data('name'))
      $('#prof_description').html($(e.target).data('long'))
      $('#prof_image').attr('src', $(e.target).data('image'))
      if($(e.target).data('other-name')) {
        $('.other').show()
        $('#prof_title_other').html($(e.target).data('title'))
        $('#prof_name_other').html($(e.target).data('other-name'))
        $('#prof_description_other').html($(e.target).data('other-long'))
        $('#prof_image_other').attr('src', $(e.target).data('other-image'))
      } else {
        $('.other').hide()
      }
      if($('.profession').hasClass('closed')) {
        $('.profession').removeClass('closed')
      }
      $('html, body').animate({
        scrollTop: $(".profession").offset().top - 100
      }, 500);
    })
    $('.profession span').on('click', (e)=> {
      $('.profession').addClass('closed')
      $('html, body').animate({
            scrollTop: $(".title").offset().top
        }, 300);
    })
    $('#type-cb-student').change(()=>{
      if($('#type-cb-student')[0].checked) {
        $('#type-cb-teacher')[0].checked = false
      }
      $('.prof-checks').toggleClass('gone')
    })
    $('#type-cb-teacher').change(()=>{
      if($('#type-cb-teacher')[0].checked) {
        $('#type-cb-student')[0].checked = false
        $('.prof-checks').addClass('gone')
      }
    })
    $(window).scroll(function() {
      if ($(document).scrollTop() > 50) {
        $('header').addClass('shrink');
      } else {
        $('header').removeClass('shrink');
      }
    });
    $('.profs .prof-item').each((i, item) => {
      let image = new Image()
      console.log("bla" + $(item).data('image'))
      image.src = $(item).data('image')
      $(".empty").append(image)
    })
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
